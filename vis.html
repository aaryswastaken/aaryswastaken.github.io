<!DOCTYPE html>
<html>
    <head> 
	<title> vis </title>
    </head>
    <body>
	<textarea id="input"> </textarea>
	<button onclick="load()"> Load </button>
	<div id="ctn"> </div>
	<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
	<script>
	   function load() {
		let data = JSON.parse(document.getElementById("input").value)
		let history = JSON.parse(data.history)


	   // Declare the chart dimensions and margins.
	   const width = 640;
            const height = 400;
            const marginTop = 20;
            const marginRight = 20;
            const marginBottom = 30;
            const marginLeft = 40;


            // Declare the x (horizontal position) scale.
            const x = d3.scaleUtc()
                .domain([new Date("2026-01-01"), new Date("2026-02-01")])
                .range([marginLeft, width - marginRight]);

            // Declare the y (vertical position) scale.
            const y = d3.scaleLinear()
                .domain([24, 0])
                .range([height - marginBottom, marginTop]);

            // Create the SVG container.
            const svg = d3.create("svg")
                .attr("width", width)
                .attr("height", height);

            const grad = svg.append("linearGradient")
              .attr("id", "Gradient1")
              .attr("x1", 0).attr("x2", 1).attr("y1", 0).attr("y2", 1)

            grad.append("stop")
              .attr("offset", "0%")
              .attr("stop-color", "red")

            grad.append("stop")
              .attr("offset", "100%")
              .attr("stop-color", "red")
  
  
  
            // Add the x-axis.
            svg.append("g")
                .attr("transform", `translate(0,${height - marginBottom})`)
                .call(d3.axisBottom(x));

            // Add the y-axis.
            svg.append("g")
                .attr("transform", `translate(${marginLeft},0)`)
                .call(d3.axisLeft(y));

            const data2 = history.map(d => {
            const split = (new Date(d["date"])).toISOString().split("T")
   const hsplit = (split[1]).split(":")
    
    const hours = parseInt(hsplit[0]) + parseInt(hsplit[1]) / 60 + parseInt(hsplit[2].split(".")[0]) / 3600

    return [split[0], hours]
  })

  const traces = svg.append("g")
    .attr("stroke", "#44b2d499")
    .attr("stroke-width", 6)
    .selectAll("line")
    .data(data2)
    .join("line")
      .attr("x1", d => x(new Date(d[0])))
      .attr("x2", d => x(new Date(d[0])))
      .attr("y1", d => y(d[1]))
      .attr("y2", d => y(d[1] + 0.75))
      .attr("stroke-linecap", "round")

  // #2020FFA0
  const dot = svg.append("g")
      .attr("fill", "none")
      .attr("stroke", "#44b2d4ff")
      .attr("stroke-width", 1.5)
    .selectAll("circle")
    .data(data2)
    .join("circle")
      .attr("transform", d => `translate(${x(new Date(d[0]))}, ${y(d[1])})`)
      .attr("r", 3);

  console.log(dot.node());

  // Return the SVG element.
    document.getElementById("ctn").append(svg.node())
	   }
	</script>
    </body>
</html>
